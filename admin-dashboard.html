<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Misterpips</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getDatabase, ref, set, get, onValue, remove } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDSDK0NfVSs_VQb3TnrixiJbOpTsmoUMvU",
            authDomain: "misterpips-b71fb.firebaseapp.com",
            databaseURL: "https://misterpips-b71fb-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "misterpips-b71fb",
            storageBucket: "misterpips-b71fb.firebasestorage.app",
            messagingSenderId: "574231126409",
            appId: "1:574231126409:web:b7ed93ac4ea62e247dc158"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        window.dbRef = ref;
        window.dbGet = get;
        window.dbSet = set;
        window.onValue = onValue;
        window.dbRemove = remove;
        window.signOut = signOut;
        
        onAuthStateChanged(auth, (user) => {
            if (!user || user.uid !== 'tr8b3TuRAeTKAqT9kx00YmQa6gA3') {
                window.location.href = 'index.html';
            } else {
                document.getElementById('adminEmail').textContent = user.email;
            }
        });
        
        console.log('✅ Firebase Admin initialisé');
    </script>
</head>
<body class="dashboard-body">
    <!-- Header Admin -->
    <header class="dashboard-header">
        <div class="header-container">
            <div class="header-left">
                <button id="backBtn" class="back-btn" onclick="window.location.href='vip-space.html'">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="brand-section">
                    <div class="brand-logo">
                        <img src="assets/images/Misterpips.jpg" alt="Misterpips Logo" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                    </div>
                    <div class="brand-info">
                        <h1>Administration</h1>
                        <span class="brand-subtitle">Panneau de contrôle</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="user-details">
                        <span id="adminEmail" class="user-email"></span>
                        <span class="user-status">Administrateur</span>
                    </div>
                </div>
                <button id="logoutBtn" class="logout-btn" onclick="admin.logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Admin -->
    <main class="dashboard-main">
        <!-- Sidebar Admin -->
        <aside class="dashboard-sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Administration</h3>
                    <a href="#users" class="nav-item active" onclick="admin.showUsers()">
                        <i class="fas fa-users"></i>
                        <span>Utilisateurs</span>
                    </a>
                    <a href="#analytics" class="nav-item" onclick="admin.showAnalytics()">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                    </a>
                    <a href="#system" class="nav-item" onclick="admin.showSystem()">
                        <i class="fas fa-cog"></i>
                        <span>Système</span>
                    </a>
                </div>
                <div class="nav-section">
                    <h3>Configuration</h3>
                    <a href="#siteconfig" class="nav-item" onclick="admin.showSiteConfig()">
                        <i class="fas fa-globe"></i>
                        <span>Config Site</span>
                    </a>
                    <a href="#backup" class="nav-item" onclick="admin.backupData()">
                        <i class="fas fa-download"></i>
                        <span>Sauvegarde</span>
                    </a>
                    <a href="#logs" class="nav-item" onclick="admin.showLogs()">
                        <i class="fas fa-file-alt"></i>
                        <span>Logs</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Content Admin -->
        <div class="dashboard-content">
            <!-- Stats Admin -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Utilisateurs VIP</span>
                            <span id="totalUsers" class="stat-value">0</span>
                            <span class="stat-change positive">+0</span>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Trades Total</span>
                            <span id="totalTrades" class="stat-value">0</span>
                            <span class="stat-change positive">+0</span>
                        </div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Volume Total</span>
                            <span id="totalVolume" class="stat-value">$0</span>
                            <span class="stat-change neutral">0%</span>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Actifs Aujourd'hui</span>
                            <span id="activeToday" class="stat-value">0</span>
                            <span class="stat-change neutral">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section Utilisateurs -->
            <section id="usersSection" class="admin-section">
                <div class="section-header">
                    <h2>Gestion des Utilisateurs</h2>
                    <div class="section-actions">
                        <button class="btn-primary" onclick="admin.addUser()">
                            <i class="fas fa-plus"></i>
                            Ajouter Utilisateur
                        </button>
                        <button class="btn-secondary" onclick="admin.refreshUsers()">
                            <i class="fas fa-sync"></i>
                            Actualiser
                        </button>
                    </div>
                </div>
                <div class="users-container">
                    <div class="users-table">
                        <div class="table-header">
                            <div class="th">Email</div>
                            <div class="th">Pseudo</div>
                            <div class="th">Plan</div>
                            <div class="th">Trades</div>
                            <div class="th">P&L</div>
                            <div class="th">Dernière Activité</div>
                            <div class="th">Actions</div>
                        </div>
                        <div id="usersTableBody" class="table-body">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section Analytics -->
            <section id="analyticsSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>Analytics Globales</h2>
                    <select id="analyticsFilter">
                        <option value="daily">Aujourd'hui</option>
                        <option value="weekly">Cette semaine</option>
                        <option value="monthly">Ce mois</option>
                        <option value="all">Tout temps</option>
                    </select>
                </div>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Performance par Utilisateur</h3>
                        <div id="userPerformance" class="analytics-content"></div>
                    </div>
                    <div class="analytics-card">
                        <h3>Instruments les plus tradés</h3>
                        <div id="topInstruments" class="analytics-content"></div>
                    </div>
                    <div class="analytics-card">
                        <h3>Activité par jour</h3>
                        <div id="dailyActivity" class="analytics-content"></div>
                    </div>
                </div>
            </section>

            <!-- Section Configuration Site -->
            <section id="siteConfigSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>Configuration du Site</h2>
                    <button class="btn-primary" onclick="admin.saveSiteConfig()">
                        <i class="fas fa-save"></i>
                        Sauvegarder
                    </button>
                </div>
                <div class="config-grid">
                    <div class="config-card">
                        <h3>Statistiques Hero</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label>Profit Total:</label>
                                <input type="text" id="heroProfit" placeholder="+2,847$">
                            </div>
                            <div class="form-group">
                                <label>Win Rate:</label>
                                <input type="text" id="heroWinRate" placeholder="87.3%">
                            </div>
                        </div>
                    </div>
                    <div class="config-card">
                        <h3>Statistiques Communauté</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label>Traders VIP:</label>
                                <input type="text" id="tradersCount" placeholder="500+">
                            </div>
                            <div class="form-group">
                                <label>Taux de réussite:</label>
                                <input type="text" id="successRate" placeholder="87%">
                            </div>
                            <div class="form-group">
                                <label>Profits cumulés:</label>
                                <input type="text" id="totalProfits" placeholder="2.8M$">
                            </div>
                            <div class="form-group">
                                <label>Support:</label>
                                <input type="text" id="supportTime" placeholder="24/7">
                            </div>
                        </div>
                    </div>
                    <div class="config-card">
                        <h3>À propos</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label>Traders VIP:</label>
                                <input type="text" id="aboutTraders" placeholder="500+">
                            </div>
                            <div class="form-group">
                                <label>Taux de réussite:</label>
                                <input type="text" id="aboutSuccess" placeholder="87%">
                            </div>
                            <div class="form-group">
                                <label>Support:</label>
                                <input type="text" id="aboutSupport" placeholder="24/7">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section Système -->
            <section id="systemSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>Configuration Système</h2>
                </div>
                <div class="system-grid">
                    <div class="system-card">
                        <h3>Base de Données</h3>
                        <div class="system-info">
                            <p>Status: <span id="dbStatus" class="status-ok">Connecté</span></p>
                            <p>Dernière sauvegarde: <span id="lastBackup">Jamais</span></p>
                        </div>
                        <div class="system-actions">
                            <button class="btn-primary" onclick="admin.testConnection()">Test Connexion</button>
                            <button class="btn-warning" onclick="admin.cleanupData()">Nettoyer</button>
                        </div>
                    </div>
                    <div class="system-card">
                        <h3>Maintenance</h3>
                        <div class="system-info">
                            <p>Mode maintenance: <span id="maintenanceMode" class="status-off">Désactivé</span></p>
                            <p>Version: <span>2.0.0</span></p>
                        </div>
                        <div class="system-actions">
                            <button class="btn-secondary" onclick="admin.toggleMaintenance()">Basculer Mode</button>
                            <button class="btn-danger" onclick="admin.resetSystem()">Reset Système</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal Admin -->
    <div id="adminModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modalTitle">Administration</h2>
                <button class="modal-close" onclick="admin.closeModal()">&times;</button>
            </div>
            <div class="modal-content">
                <div id="modalContent">
                    <!-- Modal content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/admin.js"></script>
</body>
</html>